lappend auto_path [pwd]/../
package require tcltest
package require htmltmpl

tcltest::test tmpl_var-1.0 {
	TMPL_VAR single
} -body {
	htmltmpl::compile_str "<TMPL_VAR NAME=v1>"
} -result {chunks {{TMPL_VAR v1 {}}}}

tcltest::test tmpl_var-1.1 {
	TMPL_VAR single(with spaces)
} -body {
	htmltmpl::compile_str "<TMPL_VAR  NAME =   v1    >"
} -result {chunks {{TMPL_VAR v1 {}}}}

tcltest::test tmpl_var-1.2 {
	TMPL_VAR single(surrounded with spaces)
} -body {
	htmltmpl::compile_str " <TMPL_VAR  NAME =   v1    > "
} -result {chunks {{TEXT { }} {TMPL_VAR v1 {}} {TEXT { }}}}

tcltest::test tmpl_var-2.0 {
	TMPL_VAR with text prepended
} -body {
	htmltmpl::compile_str "some text<TMPL_VAR NAME=v1>"
} -result {chunks {{TEXT {some text}} {TMPL_VAR v1 {}}}}

tcltest::test tmpl_var-2.1 {
	TMPL_VAR with text prepended(with space)
} -body {
	htmltmpl::compile_str "some text <TMPL_VAR NAME=v1>"
} -result {chunks {{TEXT {some text }} {TMPL_VAR v1 {}}}}

tcltest::test tmpl_var-2.2 {
	TMPL_VAR with text prepended(with spaces)
} -body {
	htmltmpl::compile_str "some text  <TMPL_VAR NAME=v1>"
} -result {chunks {{TEXT {some text  }} {TMPL_VAR v1 {}}}}

tcltest::test tmpl_var-3.0 {
	TMPL_VAR with text appended
} -body {
	htmltmpl::compile_str "<TMPL_VAR NAME=v1>some text"
} -result {chunks {{TMPL_VAR v1 {}} {TEXT {some text}}}}

tcltest::test tmpl_var-3.1 {
	TMPL_VAR with text appended(with space)
} -body {
	htmltmpl::compile_str "<TMPL_VAR NAME=v1> some text"
} -result {chunks {{TMPL_VAR v1 {}} {TEXT { some text}}}}

tcltest::test tmpl_var-3.2 {
	TMPL_VAR with text appended(with spaces)
} -body {
	htmltmpl::compile_str "<TMPL_VAR NAME=v1> some text "
} -result {chunks {{TMPL_VAR v1 {}} {TEXT { some text }}}}

tcltest::test tmpl_var-3.3 {
	TMPL_VAR with text appended(with spaces)
} -body {
	htmltmpl::compile_str "<TMPL_VAR NAME=v1>  some text "
} -result {chunks {{TMPL_VAR v1 {}} {TEXT {  some text }}}}

tcltest::test tmpl_var-4.0 {
	TMPL_VAR on several lines
} -body {
	htmltmpl::compile_str "<TMPL_VAR\nNAME\n=\nv1\n>"
} -result {chunks {{TMPL_VAR v1 {}}}}

tcltest::test tmpl_var-5.0 {
	TMPL_VAR apply with no var in data
} -body {
	set tmpl [htmltmpl::compile_str "text <TMPL_VAR NAME = v1> here"]
	htmltmpl::apply $tmpl {}
} -result {text  here}

tcltest::test tmpl_var-5.1 {
	TMPL_VAR apply
} -body {
	set tmpl [htmltmpl::compile_str "text <TMPL_VAR NAME = v1> here"]
	htmltmpl::apply $tmpl {v1 value}
} -result {text value here}

tcltest::test tmpl_var-5.2 {
	TMPL_VAR apply(many words)
} -body {
	set tmpl [htmltmpl::compile_str "text <TMPL_VAR NAME = v1> here"]
	htmltmpl::apply $tmpl {v1 { some words }}
} -result {text  some words  here}

tcltest::test tmpl_var-5.3 {
	TMPL_VAR apply(many vars)
} -body {
	set tmpl [htmltmpl::compile_str "text <TMPL_VAR NAME = v1> here"]
	htmltmpl::apply $tmpl {v2 1 v1 { some words } v3 2}
} -result {text  some words  here}

tcltest::test tmpl_var-5.4 {
	TMPL_VAR apply with no needed var in data
} -body {
	set tmpl [htmltmpl::compile_str "text <TMPL_VAR NAME = v1> here"]
	htmltmpl::apply $tmpl {v2 value}
} -result {text  here}

tcltest::test tmpl_var-5.5 {
	TMPL_VAR apply(many tmpl_var)
} -body {
	set tmpl [htmltmpl::compile_str "text <TMPL_VAR NAME = v1> here<TMPL_VAR NAME = v1>q"]
	htmltmpl::apply $tmpl {v1 value}
} -result {text value herevalueq}

tcltest::test tmpl_var-6.0 {
	TMPL_VAR with DEFAULT
} -body {
	htmltmpl::compile_str "text <TMPL_VAR NAME = v1 DEFAULT=\"1 2\"> here<TMPL_VAR NAME = v1>q"
} -result {chunks {{TEXT {text }} {TMPL_VAR v1 {1 2}} {TEXT { here}} {TMPL_VAR v1 {}} {TEXT q}}}

tcltest::test tmpl_var-7.0 {
	TMPL_VAR apply(with DEFAULT)
} -body {
	set tmpl [htmltmpl::compile_str "text <TMPL_VAR NAME = v1 DEFAULT=\"1 2\"> here<TMPL_VAR NAME = v1>q"]
	htmltmpl::apply $tmpl {v1 value}
} -result {text value herevalueq}

tcltest::test tmpl_var-7.1 {
	TMPL_VAR apply(with DEFAULT)
} -body {
	set tmpl [htmltmpl::compile_str "text <TMPL_VAR NAME = v1 DEFAULT=\"1 2\"> here<TMPL_VAR NAME = v1>q"]
	htmltmpl::apply $tmpl {v2 value}
} -result {text 1 2 hereq}

tcltest::test tmpl_var-err-1.0 {
	TMPL_VAR compile err(no NAME)
} -body {
	htmltmpl::compile_str "text <TMPL_VAR NAM = v1> here"
} -returnCodes error -result "at line 1: TMPL_VAR: NAME is missed"

tcltest::cleanupTests
